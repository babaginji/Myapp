{% extends "ai_diagnosis/base.html" %}
{% block content %}
<div class="container">
    <h1>診断結果</h1>

    <!-- メイン・サブタイプ表示はそのまま -->
    <!-- メインタイプ -->
    <div class="result-box main-result">
        <span class="type-label">メインタイプ</span>
        <p class="type-name">{{ main_result }}</p>
    </div>
    <div class="description-container">
        <p class="description" id="main-desc">{{ main_desc }}</p>
        <button class="toggle-btn" onclick="toggleDescription('main-desc', this)">すべて見る ⇩</button>
    </div>
    <div class="description-container">
        <p class="description" id="main-desc2">{{ main_desc2 }}</p>
        <button class="toggle-btn" onclick="toggleDescription('main-desc2', this)">すべて見る ⇩</button>
    </div>

    <!-- サブタイプ -->
    <div class="result-box sub-result">
        <span class="type-label">サブタイプ</span>
        <p class="type-name">{{ sub_result }}</p>
    </div>
    <div class="description-container">
        <p class="description" id="sub-desc">{{ sub_desc }}</p>
        <button class="toggle-btn" onclick="toggleDescription('sub-desc', this)">すべて見る ⇩</button>
    </div>
    <div class="description-container">
        <p class="description" id="sub-desc2">{{ sub_desc2 }}</p>
        <button class="toggle-btn" onclick="toggleDescription('sub-desc2', this)">すべて見る ⇩</button>
    </div>

    <h2>次に進むにはこちら</h2>

    <div class="next-steps">
        <a href="{{ url_for('ai_bp.result_books') }}" class="card">本で学ぶ</a>
        <a href="{{ url_for('ai_bp.result_learning') }}" class="card">学習サイト</a>
        <a href="{{ url_for('ai_bp.result_start') }}" class="card">投資を始める</a>
    </div>

    <a href="{{ url_for('ai_bp.index') }}">
        <button>もう一度診断する</button>
    </a>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const descs = document.querySelectorAll(".description");
        descs.forEach(desc => {
            // collapsedHeight を 1行分に設定
            const lineHeight = parseFloat(getComputedStyle(desc).lineHeight);
            const collapsedHeight = lineHeight * 1; // 1行分
            desc.style.maxHeight = collapsedHeight + "px";
            desc.dataset.collapsedHeight = collapsedHeight + "px";
        });
    });
    
    function toggleDescription(id, btn) {
        const desc = document.getElementById(id);
        if (!desc) return;
    
        if (desc.classList.contains("expanded")) {
            // 閉じる
            desc.style.maxHeight = desc.dataset.collapsedHeight;
            desc.classList.remove("expanded");
            btn.textContent = "すべて見る ⇩";
        } else {
            // 開く
            desc.style.maxHeight = desc.scrollHeight + "px";
            desc.classList.add("expanded");
            btn.textContent = "閉じる ⇧";
        }
    }
</script>
{% endblock %}
