{% extends "ai_diagnosis/base.html" %}
{% block content %}
<div class="container">
    <h1>診断結果</h1>

    <!-- メイン・サブタイプ表示はそのまま -->
    <!-- メインタイプ -->
    <div class="result-box main-result">
        <span class="type-label">メインタイプ</span>
        <p class="type-name">{{ main_result }}</p>
    </div>
    <div class="description-container">
        <p class="description" id="main-desc1">{{ main_desc1 }}</p>
        <button class="toggle-btn" onclick="toggleDescription('main-desc1', this)">すべて見る ⇩</button>
    </div>
    <div class="description-container">
        <p class="description" id="main-desc2">{{ main_desc2 }}</p>
        <button class="toggle-btn" onclick="toggleDescription('main-desc2', this)">すべて見る ⇩</button>
    </div>
    

    <!-- サブタイプ -->
    <div class="result-box sub-result">
        <span class="type-label">サブタイプ</span>
        <p class="type-name">{{ sub_result }}</p>
    </div>
    <div class="description-container">
        <p class="description" id="sub-desc1">{{ sub_desc1 }}</p>
        <button class="toggle-btn" onclick="toggleDescription('sub-desc1', this)">すべて見る ⇩</button>
    </div>
    <div class="description-container">
        <p class="description" id="sub-desc2">{{ sub_desc2 }}</p>
        <button class="toggle-btn" onclick="toggleDescription('sub-desc2', this)">すべて見る ⇩</button>
    </div>
    

    <h2>次に進むにはこちら</h2>
<div class="next-steps">
    <a href="{{ url_for('ai_diagnosis.result_books') }}" class="card">
        <img src="{{ url_for('static', filename='images/books.jpg') }}" alt="本で学ぶ">
        <p>本で学ぶ</p>
    </a>

    <a href="{{ url_for('ai_diagnosis.result_learning') }}" class="card">
        <img src="{{ url_for('static', filename='images/learning.jpg') }}" alt="学習サイト">
        <p>学習サイト</p>
    </a>

    <a href="{{ url_for('ai_diagnosis.result_start') }}" class="card">
        <img src="{{ url_for('static', filename='images/start.jpeg') }}" alt="投資を始める">
        <p>投資を始める</p>
    </a>

    <a href="#" class="card">
        <img src="{{ url_for('static', filename='images/advice.jpg') }}" alt="投資アドバイス">
        <p>アドバイス</p>
    </a>
    <!-- ページめくり用ラッパー -->
<div id="swipePage" class="swipe-page"></div>
</div>

    

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const descs = document.querySelectorAll(".description");
        descs.forEach(desc => {
            // collapsedHeight を 1行分に設定
            const lineHeight = parseFloat(getComputedStyle(desc).lineHeight);
            const collapsedHeight = lineHeight * 1; // 1行分
            desc.style.maxHeight = collapsedHeight + "px";
            desc.dataset.collapsedHeight = collapsedHeight + "px";
        });
    });
    
    function toggleDescription(id, btn) {
        const desc = document.getElementById(id);
        if (!desc) return;
    
        if (desc.classList.contains("expanded")) {
            // 閉じる
            desc.style.maxHeight = desc.dataset.collapsedHeight;
            desc.classList.remove("expanded");
            btn.textContent = "すべて見る ⇩";
        } else {
            // 開く
            desc.style.maxHeight = desc.scrollHeight + "px";
            desc.classList.add("expanded");
            btn.textContent = "閉じる ⇧";
        }
    }
    // 左スワイプで feed に戻る（ページめくりアニメ）
    let startX = 0;
    let endX = 0;

    document.addEventListener('touchstart', e => {
        startX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', e => {
        endX = e.changedTouches[0].screenX;
        handleSwipePage();
    });

    function handleSwipePage() {
        const swipeThreshold = 50; // 最低スワイプ距離
        if (startX - endX > swipeThreshold) {
            const swipePage = document.getElementById('swipePage');
            swipePage.classList.add('active'); // ページめくり開始

            // アニメ終了後に feed ページへ遷移
            setTimeout(() => {
                window.location.href = "{{ url_for('ai_diagnosis.ai_home') }}"; // feed ページURL
            }, 500); // CSS transition に合わせる
        }
    }
</script>
{% endblock %}
